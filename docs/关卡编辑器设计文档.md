# å…³å¡ç¼–è¾‘å™¨è®¾è®¡æ–‡æ¡£

## éœ€æ±‚æ¦‚è¿°

1. ä½¿ç”¨ JSON æ•°æ®ç»“æ„æè¿°å…³å¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬åœ°å›¾ã€ç›®æ ‡åˆ†æ•°ã€æ—¶é—´ã€è®¢å•æ± 
2. æä¾›å¯è§†åŒ–ç•Œé¢æ¥æ­å»ºå…³å¡ï¼Œç”Ÿæˆå’Œå¯¼å‡º JSON æ•°æ®
3. æ”¯æŒå¯¼å…¥å’Œåˆ†äº«å…³å¡ JSON æ–‡ä»¶

## å…³å¡æ•°æ®ç»“æ„

### è®¾è®¡åŸåˆ™

- **å•ç‹¬æè¿°æ¯ä¸ªå¯¹è±¡**ï¼šåœ°æ¿ã€å·¥ä½œç«™ã€ç©å®¶éƒ½ä½¿ç”¨ç‹¬ç«‹çš„é…ç½®å¯¹è±¡
- **æ”¯æŒæ‰©å±•å±æ€§**ï¼šæ¯ç§ç±»å‹çš„å¯¹è±¡éƒ½å¯ä»¥æœ‰è‡ªå·±ç‰¹æœ‰çš„å±æ€§
- **é¿å…å­—ç¬¦ä¸²åœ°å›¾**ï¼šä¸å†ä½¿ç”¨å­—ç¬¦çŸ©é˜µæ¥è¡¨è¾¾åœ°å›¾å¸ƒå±€
- **æ”¯æŒå¤æ‚åœ°æ¿**ï¼šå¦‚ä¼ é€å¸¦éœ€è¦æ–¹å‘ã€é€Ÿåº¦ç­‰å±æ€§

### å…³å¡ç¼–è¾‘å™¨é¡µé¢

å…³å¡ç¼–è¾‘å™¨é¡µé¢å’Œæ­£å¸¸æ¸¸æˆçš„é¡µé¢ä¸å±äºåŒä¸€ä¸ªè·¯ç”±

- `/` ä¸»é¡µé¢è·¯ç”±æ˜¾ç¤ºæ­£å¸¸æ¸¸æˆ
- `/editor` è·¯ç”±æ˜¾ç¤ºå…³å¡ç¼–è¾‘é¡µé¢

### å®Œæ•´æ•°æ®ç»“æ„

```typescript
interface LevelConfig {
  // åŸºç¡€ä¿¡æ¯
  id: string;                    // å…³å¡å”¯ä¸€ID
  name: string;                  // å…³å¡åç§°
  description?: string;          // å…³å¡æè¿°
  version: string;               // æ•°æ®ç»“æ„ç‰ˆæœ¬å·ï¼ˆç”¨äºæœªæ¥å…¼å®¹ï¼‰
  
  // æ¸¸æˆè®¾ç½®
  gameType: 'local-coop' | 'local-versus' | 'online-coop' | 'online-versus';
  duration: number;              // æ¸¸æˆæ—¶é•¿ï¼ˆç§’ï¼‰
  
  // ç›®æ ‡åˆ†æ•°ï¼ˆæ˜Ÿçº§ï¼‰
  scoreTarget: {
    star1: number;               // 1æ˜Ÿåˆ†æ•°
    star2: number;               // 2æ˜Ÿåˆ†æ•°
    star3: number;               // 3æ˜Ÿåˆ†æ•°
    star4?: number;              // 4æ˜Ÿåˆ†æ•°ï¼ˆå¯é€‰ï¼‰
  };
  
  // åœ°å›¾é…ç½®
  map: {
    width: number;               // åœ°å›¾å®½åº¦ï¼ˆæ ¼å­æ•°ï¼‰
    height: number;              // åœ°å›¾é«˜åº¦ï¼ˆæ ¼å­æ•°ï¼‰
    floors: FloorConfig[];       // åœ°æ¿é…ç½®åˆ—è¡¨
  };
  
  // ç©å®¶é…ç½®
  players: PlayerSpawn[];
  
  // å·¥ä½œç«™é…ç½®
  stations: StationConfig[];
  
  // è®¢å•æ± é…ç½®
  orderPool: {
    recipes: string[];           // å¯ç”¨èœè°±IDåˆ—è¡¨
    maxActiveOrders: number;     // æœ€å¤§åŒæ—¶è®¢å•æ•°
    spawnInterval: number;       // è®¢å•ç”Ÿæˆé—´éš”ï¼ˆç§’ï¼‰
  };
}

// ==================== ç©å®¶é…ç½® ====================

interface PlayerSpawn {
  id: number;                    // ç©å®¶ç¼–å·ï¼ˆ1æˆ–2ï¼‰
  x: number;                     // Xåæ ‡ï¼ˆæ ¼å­ï¼‰
  y: number;                     // Yåæ ‡ï¼ˆæ ¼å­ï¼‰
  color?: number;                // ç©å®¶é¢œè‰²ï¼ˆå¯é€‰ï¼Œ16è¿›åˆ¶ï¼‰
}

// ==================== åœ°æ¿é…ç½® ====================

// åœ°æ¿é…ç½®ï¼ˆåŸºç±»ï¼‰
interface BaseFloorConfig {
  type: FloorType;               // åœ°æ¿ç±»å‹
  x: number;                     // Xåæ ‡ï¼ˆæ ¼å­ï¼‰
  y: number;                     // Yåæ ‡ï¼ˆæ ¼å­ï¼‰
}

// åœ°æ¿ç±»å‹
type FloorType = 
  | 'normal'                     // æ™®é€šåœ°æ¿
  | 'wall'                       // å¢™å£ï¼ˆä¸å¯é€šè¡Œï¼‰
  | 'conveyor';                  // ä¼ é€å¸¦

// è”åˆç±»å‹ï¼šæ‰€æœ‰åœ°æ¿é…ç½®
type FloorConfig = NormalFloor | WallFloor | ConveyorFloor;

// æ™®é€šåœ°æ¿
interface NormalFloor extends BaseFloorConfig {
  type: 'normal';
  texture?: string;              // è‡ªå®šä¹‰çº¹ç†keyï¼ˆå¯é€‰ï¼‰
}

// å¢™å£
interface WallFloor extends BaseFloorConfig {
  type: 'wall';
  texture?: string;              // è‡ªå®šä¹‰çº¹ç†keyï¼ˆå¯é€‰ï¼‰
}

// ä¼ é€å¸¦åœ°æ¿
interface ConveyorFloor extends BaseFloorConfig {
  type: 'conveyor';
  direction: 'up' | 'down' | 'left' | 'right';  // ä¼ é€æ–¹å‘
  speed: number;                 // ä¼ é€é€Ÿåº¦ï¼ˆåƒç´ /ç§’ï¼‰
  texture?: string;              // è‡ªå®šä¹‰çº¹ç†keyï¼ˆå¯é€‰ï¼‰
}

// ==================== å·¥ä½œç«™é…ç½® ====================

// å·¥ä½œç«™é…ç½®ï¼ˆåŸºç±»ï¼‰
interface BaseStationConfig {
  type: StationType;             // å·¥ä½œç«™ç±»å‹
  x: number;                     // Xåæ ‡ï¼ˆæ ¼å­ï¼‰
  y: number;                     // Yåæ ‡ï¼ˆæ ¼å­ï¼‰
  rotation?: number;             // æ—‹è½¬è§’åº¦ï¼ˆåº¦æ•°ï¼Œå¯é€‰ï¼‰
}

// å·¥ä½œç«™ç±»å‹æšä¸¾
type StationType = 
  | 'counter'                    // ç©ºæŸœå°
  | 'plate-counter'              // å¸¦ç›˜å­çš„æŸœå°
  | 'cut'                        // åˆ‡èœæ¿
  | 'pot'                        // ç‚’é”…/ç…®é”…
  | 'sink'                       // æ´—ç¢—æ± 
  | 'delivery'                   // ä¸Šèœå£
  | 'dirty-plate'                // è„ç›˜å­ç”Ÿæˆç‚¹
  | 'trash'                      // åƒåœ¾æ¡¶
  | 'fire-extinguisher'          // ç­ç«å™¨
  | 'mixer'                      // æ…æ‹Œå™¨
  | 'ingredient';                // é£Ÿæç®±

// è”åˆç±»å‹ï¼šæ‰€æœ‰å·¥ä½œç«™é…ç½®
type StationConfig = 
  | CounterStation
  | PlateCounterStation
  | CutStation
  | PotStation
  | SinkStation
  | DeliveryStation
  | DirtyPlateStation
  | TrashStation
  | FireExtinguisherStation
  | MixerStation
  | IngredientStation;

// ç©ºæŸœå°
interface CounterStation extends BaseStationConfig {
  type: 'counter';
}

// å¸¦ç›˜å­çš„æŸœå°
interface PlateCounterStation extends BaseStationConfig {
  type: 'plate-counter';
  infinite?: boolean;            // æ˜¯å¦æ— é™ä¾›åº”ç›˜å­ï¼ˆé»˜è®¤trueï¼‰
  maxPlates?: number;            // æœ€å¤§ç›˜å­æ•°ï¼ˆå¦‚æœinfiniteä¸ºfalseï¼‰
}

// åˆ‡èœæ¿
interface CutStation extends BaseStationConfig {
  type: 'cut';
  cutSpeed?: number;             // åˆ‡å‰²é€Ÿåº¦å€ç‡ï¼ˆé»˜è®¤1.0ï¼‰
}

// ç‚’é”…/ç…®é”…
interface PotStation extends BaseStationConfig {
  type: 'pot';
  cookSpeed?: number;            // çƒ¹é¥ªé€Ÿåº¦å€ç‡ï¼ˆé»˜è®¤1.0ï¼‰
  canBurn?: boolean;             // æ˜¯å¦ä¼šçƒ§ç„¦ï¼ˆé»˜è®¤trueï¼‰
  canFire?: boolean;             // æ˜¯å¦ä¼šç€ç«ï¼ˆé»˜è®¤trueï¼‰
}

// æ´—ç¢—æ± 
interface SinkStation extends BaseStationConfig {
  type: 'sink';
  washSpeed?: number;            // æ¸…æ´—é€Ÿåº¦å€ç‡ï¼ˆé»˜è®¤1.0ï¼‰
}

// ä¸Šèœå£
interface DeliveryStation extends BaseStationConfig {
  type: 'delivery';
  deliveryTime?: number;         // ä¸ŠèœåŠ¨ç”»æ—¶é—´ï¼ˆæ¯«ç§’ï¼Œé»˜è®¤500ï¼‰
}

// è„ç›˜å­ç”Ÿæˆç‚¹
interface DirtyPlateStation extends BaseStationConfig {
  type: 'dirty-plate';
  spawnInterval?: number;        // ç”Ÿæˆé—´éš”ï¼ˆç§’ï¼Œé»˜è®¤10ï¼‰
  maxPlates?: number;            // æœ€å¤§è„ç›˜å­æ•°ï¼ˆé»˜è®¤3ï¼‰
}

// åƒåœ¾æ¡¶
interface TrashStation extends BaseStationConfig {
  type: 'trash';
}

// ç­ç«å™¨
interface FireExtinguisherStation extends BaseStationConfig {
  type: 'fire-extinguisher';
  infinite?: boolean;            // æ˜¯å¦æ— é™ä½¿ç”¨ï¼ˆé»˜è®¤trueï¼‰
  capacity?: number;             // å®¹é‡ï¼ˆå¦‚æœinfiniteä¸ºfalseï¼‰
}

// æ…æ‹Œå™¨
interface MixerStation extends BaseStationConfig {
  type: 'mixer';
  mixSpeed?: number;             // æ…æ‹Œé€Ÿåº¦å€ç‡ï¼ˆé»˜è®¤1.0ï¼‰
}

// é£Ÿæç®±
interface IngredientStation extends BaseStationConfig {
  type: 'ingredient';
  ingredientType: IngredientType; // é£Ÿæç±»å‹
  infinite?: boolean;             // æ˜¯å¦æ— é™ä¾›åº”ï¼ˆé»˜è®¤trueï¼‰
  maxCount?: number;              // æœ€å¤§æ•°é‡ï¼ˆå¦‚æœinfiniteä¸ºfalseï¼‰
}

// é£Ÿæç±»å‹
type IngredientType = 
  | 'tomato'                     // ç•ªèŒ„
  | 'lettuce'                    // ç”Ÿèœ
  | 'rice'                       // ç±³
  | 'fish'                       // é±¼
  | 'seaweed'                    // ç´«èœ
  | 'onion'                      // æ´‹è‘±
  | 'potato'                     // åœŸè±†
  | 'carrot'                     // èƒ¡èåœ
  | 'egg'                        // é¸¡è›‹
  | 'flour'                      // é¢ç²‰
  | 'meat'                       // è‚‰
  | 'cheese'                     // èŠå£«
  | 'chocolate'                  // å·§å…‹åŠ›
  | 'burger-bun';                // æ±‰å ¡é¢åŒ…
```

### æ•°æ®ç»“æ„ç¤ºä¾‹

```json
{
  "id": "level-001",
  "name": "æ–°æ‰‹å…³å¡",
  "description": "å­¦ä¹ åŸºç¡€æ“ä½œ",
  "version": "1.0",
  "gameType": "local-coop",
  "duration": 300,
  "scoreTarget": {
    "star1": 100,
    "star2": 200,
    "star3": 300,
    "star4": 500
  },
  "map": {
    "width": 17,
    "height": 13,
    "floors": [
      { "type": "normal", "x": 0, "y": 0 },
      { "type": "normal", "x": 1, "y": 0 },
      { "type": "normal", "x": 2, "y": 0 },
      { "type": "wall", "x": 0, "y": 1 },
      { "type": "conveyor", "x": 5, "y": 5, "direction": "right", "speed": 100 },
      { "type": "conveyor", "x": 6, "y": 5, "direction": "right", "speed": 100 },
      { "type": "conveyor", "x": 7, "y": 5, "direction": "down", "speed": 100 }
    ]
  },
  "players": [
    { "id": 1, "x": 4, "y": 6, "color": 5087743 },
    { "id": 2, "x": 12, "y": 6, "color": 16728132 }
  ],
  "stations": [
    { "type": "delivery", "x": 6, "y": 1 },
    { "type": "trash", "x": 2, "y": 1 },
    { "type": "counter", "x": 3, "y": 3 },
    { "type": "pot", "x": 5, "y": 3, "cookSpeed": 1.2, "canFire": true },
    { 
      "type": "ingredient", 
      "x": 4, 
      "y": 4, 
      "ingredientType": "lettuce",
      "infinite": true
    },
    { "type": "cut", "x": 4, "y": 5, "cutSpeed": 1.0 },
    { 
      "type": "ingredient", 
      "x": 2, 
      "y": 9, 
      "ingredientType": "tomato",
      "infinite": false,
      "maxCount": 10
    },
    {
      "type": "plate-counter",
      "x": 6,
      "y": 6,
      "infinite": true
    },
    {
      "type": "dirty-plate",
      "x": 15,
      "y": 10,
      "spawnInterval": 15,
      "maxPlates": 5
    }
  ],
  "orderPool": {
    "recipes": ["lettuce-salad", "lettuce-tomato-salad", "fish-sushi"],
    "maxActiveOrders": 4,
    "spawnInterval": 15
  }
}
```

### ä¼ é€å¸¦åœ°æ¿è¯¦ç»†è¯´æ˜

ä¼ é€å¸¦æ˜¯ä¸€ç§ç‰¹æ®Šçš„åœ°æ¿ç±»å‹ï¼Œèƒ½å¤Ÿè‡ªåŠ¨ä¼ é€ç©å®¶æˆ–ç‰©å“ã€‚

#### ä¼ é€å¸¦å±æ€§

```typescript
interface ConveyorFloor {
  type: 'conveyor';
  x: number;                     // æ ¼å­åæ ‡X
  y: number;                     // æ ¼å­åæ ‡Y
  direction: 'up' | 'down' | 'left' | 'right';  // ä¼ é€æ–¹å‘
  speed: number;                 // ä¼ é€é€Ÿåº¦ï¼ˆåƒç´ /ç§’ï¼‰
  texture?: string;              // è‡ªå®šä¹‰çº¹ç†ï¼ˆå¯é€‰ï¼‰
}
```

## ç¼–è¾‘å™¨ç•Œé¢è®¾è®¡

### æŠ€æœ¯æ¶æ„

ç¼–è¾‘å™¨é‡‡ç”¨ **DOM + Canvas æ··åˆæ¶æ„**ï¼š

- **DOM éƒ¨åˆ†**ï¼šé¡¶éƒ¨æ ã€å·¥å…·é¢æ¿ã€å±æ€§é¢æ¿ä½¿ç”¨ HTML/CSS å®ç°
- **Canvas éƒ¨åˆ†**ï¼šåœ°å›¾ç¼–è¾‘åŒºåŸŸä½¿ç”¨ Phaser æ¸²æŸ“

è¿™ç§æ¶æ„çš„ä¼˜åŠ¿ï¼š

1. DOM é€‚åˆè¡¨å•ã€æŒ‰é’®ç­‰ UI ç»„ä»¶ï¼Œå¼€å‘æ•ˆç‡é«˜
2. Canvas é€‚åˆæ¸¸æˆå¯¹è±¡æ¸²æŸ“ï¼Œä¸æ¸¸æˆä¸»ä½“ä¸€è‡´
3. ä¸¤è€…èŒè´£åˆ†ç¦»ï¼Œæ˜“äºç»´æŠ¤

### æ•´ä½“å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…³å¡ç¼–è¾‘å™¨ (DOM: HTML é¡¶éƒ¨æ )      [ä¿å­˜] [å¯¼å…¥]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              â”‚                                     â”‚
â”‚  å·¥å…·é¢æ¿    â”‚    åœ°å›¾ç¼–è¾‘åŒºåŸŸ (Canvas: Phaser)    â”‚
â”‚  (DOM: HTML) â”‚                                     â”‚
â”‚              â”‚    [17x13 ç½‘æ ¼ç”»å¸ƒ]                 â”‚
â”‚  [åŸºç¡€è®¾ç½®]  â”‚                                     â”‚
â”‚  [åœ°æ¿]      â”‚    - ç‚¹å‡»æ”¾ç½®åœ°æ¿å’Œå·¥ä½œç«™           â”‚
â”‚  [å·¥ä½œç«™]    â”‚    - ç‚¹å‡»é€‰æ‹©/åˆ é™¤                  â”‚
â”‚  [ç©å®¶]      â”‚    - æ˜¾ç¤ºåæ ‡                       â”‚
â”‚  [è®¢å•æ± ]    â”‚                                     â”‚
â”‚              â”‚                                     â”‚
â”‚              â”‚                                     â”‚
â”‚              â”‚                                     â”‚
â”‚              â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å±æ€§é¢æ¿ (DOM: HTML)                              â”‚
â”‚  [é€‰ä¸­å¯¹è±¡çš„è¯¦ç»†å±æ€§ç¼–è¾‘]                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### HTML ç»“æ„

```html
<div id="level-editor-container">
  <!-- é¡¶éƒ¨æ  -->
  <header class="editor-header">
    <h1>å…³å¡ç¼–è¾‘å™¨</h1>
    <div class="editor-actions">
      <button id="btn-import">å¯¼å…¥JSON</button>
      <button id="btn-export">å¯¼å‡ºJSON</button>
    </div>
  </header>

  <!-- ä¸»ä½“åŒºåŸŸ -->
  <div class="editor-main">
    <!-- å·¦ä¾§å·¥å…·é¢æ¿ -->
    <aside class="editor-sidebar">
      <div class="tool-section">
        <h3>åŸºç¡€è®¾ç½®</h3>
        <!-- åŸºç¡€è®¾ç½®è¡¨å• -->
      </div>
      <div class="tool-section">
        <h3>åœ°æ¿</h3>
        <!-- åœ°æ¿å·¥å…· -->
      </div>
      <div class="tool-section">
        <h3>å·¥ä½œç«™</h3>
        <!-- å·¥ä½œç«™å·¥å…· -->
      </div>
      <div class="tool-section">
        <h3>ç©å®¶</h3>
        <!-- ç©å®¶å·¥å…· -->
      </div>
      <div class="tool-section">
        <h3>è®¢å•æ± </h3>
        <!-- è®¢å•æ± é…ç½® -->
      </div>
    </aside>

    <!-- ä¸­é—´ç”»å¸ƒåŒºåŸŸ (Phaser Canvas) -->
    <main class="editor-canvas">
      <div id="editor-game-container"></div>
    </main>
  </div>

  <!-- åº•éƒ¨å±æ€§é¢æ¿ -->
  <footer class="editor-properties">
    <h3>å±æ€§é¢æ¿</h3>
    <div id="properties-content">
      <!-- åŠ¨æ€å†…å®¹ï¼šæ ¹æ®é€‰ä¸­å¯¹è±¡æ˜¾ç¤ºä¸åŒå±æ€§ -->
    </div>
  </footer>
</div>
```

### å·¥å…·é¢æ¿

#### 1. åŸºç¡€è®¾ç½®æ ‡ç­¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŸºç¡€è®¾ç½®        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å…³å¡åç§°ï¼š      â”‚
â”‚ [____________]  â”‚
â”‚                 â”‚
â”‚ å…³å¡æè¿°ï¼š      â”‚
â”‚ [____________]  â”‚
â”‚                 â”‚
â”‚ æ¸¸æˆæ¨¡å¼ï¼š      â”‚
â”‚ (â€¢) æœ¬åœ°åˆä½œ    â”‚
â”‚ ( ) æœ¬åœ°å¯¹æˆ˜    â”‚
â”‚ ( ) çº¿ä¸Šåˆä½œ    â”‚
â”‚ ( ) çº¿ä¸Šå¯¹æˆ˜    â”‚
â”‚                 â”‚
â”‚ æ¸¸æˆæ—¶é•¿(ç§’)ï¼š  â”‚
â”‚ [____300____]   â”‚
â”‚                 â”‚
â”‚ ç›®æ ‡åˆ†æ•°ï¼š      â”‚
â”‚ â­  [__100__]   â”‚
â”‚ â­â­ [__200__]  â”‚
â”‚ â­â­â­[__300__] â”‚
â”‚ â­â­â­â­[__500]â”‚
â”‚                 â”‚
â”‚ åœ°å›¾å°ºå¯¸ï¼š      â”‚
â”‚ å®½ [_17_] æ ¼    â”‚
â”‚ é«˜ [_13_] æ ¼    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. åœ°æ¿æ ‡ç­¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åœ°æ¿ç±»å‹        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 â”‚
â”‚ [â¬œ] æ™®é€šåœ°æ¿   â”‚
â”‚ [â¬›] å¢™å£       â”‚
â”‚ [â¡ï¸] ä¼ é€å¸¦     â”‚
â”‚                 â”‚
â”‚ ä¼ é€å¸¦è®¾ç½®ï¼š    â”‚
â”‚ æ–¹å‘ï¼š[å³ â–¼]   â”‚
â”‚ é€Ÿåº¦ï¼š[_100_]   â”‚
â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3. å·¥ä½œç«™æ ‡ç­¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å·¥ä½œç«™          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 â”‚
â”‚ [ğŸ”²] ç©ºæŸœå°     â”‚
â”‚ [ğŸ½ï¸] ç›˜å­æŸœå°   â”‚
â”‚ [ğŸ”ª] åˆ‡èœæ¿     â”‚
â”‚ [ğŸ²] ç‚’é”…       â”‚
â”‚ [ğŸ’§] æ´—ç¢—æ±      â”‚
â”‚ [ğŸ“¤] ä¸Šèœå£     â”‚
â”‚ [ğŸ—‘ï¸] åƒåœ¾æ¡¶     â”‚
â”‚ [ğŸ§¯] ç­ç«å™¨     â”‚
â”‚ [ğŸŒ€] æ…æ‹Œå™¨     â”‚
â”‚                 â”‚
â”‚ é£Ÿæç®±ï¼š        â”‚
â”‚ [ğŸ…] ç•ªèŒ„ç®±     â”‚
â”‚ [ğŸ¥¬] ç”Ÿèœç®±     â”‚
â”‚ [ğŸš] ç±³ç®±       â”‚
â”‚ [ğŸŸ] é±¼ç®±       â”‚
â”‚ [ğŸŒ¿] ç´«èœç®±     â”‚
â”‚ [ğŸ§…] æ´‹è‘±ç®±     â”‚
â”‚ [ğŸ¥”] åœŸè±†ç®±     â”‚
â”‚ [ğŸ¥•] èƒ¡èåœç®±   â”‚
â”‚ [ğŸ¥š] é¸¡è›‹ç®±     â”‚
â”‚ [ğŸŒ¾] é¢ç²‰ç®±     â”‚
â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4. ç©å®¶æ ‡ç­¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç©å®¶å‡ºç”Ÿç‚¹       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  â”‚
â”‚ [â–²1] ç©å®¶1       â”‚
â”‚      é¢œè‰²:#4da6ffâ”‚
â”‚                  â”‚
â”‚ [â–²2] ç©å®¶2       â”‚
â”‚      é¢œè‰²:#ff4444â”‚
â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 5. è®¢å•æ± æ ‡ç­¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¢å•æ± é…ç½®      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯ç”¨èœè°±ï¼š      â”‚
â”‚ â˜‘ ç”Ÿèœæ²™æ‹‰      â”‚
â”‚ â˜‘ ç”Ÿèœç•ªèŒ„æ²™æ‹‰  â”‚
â”‚ â˜‘ é±¼å¯¿å¸        â”‚
â”‚ â˜‘ é±¼åˆºèº«        â”‚
â”‚ â˜‘ ç•ªèŒ„æ±¤        â”‚
â”‚ â˜‘ è”¬èœæ±¤        â”‚
â”‚ â–¡ æ¸…è›‹ç³•        â”‚
â”‚ â–¡ å·§å…‹åŠ›è›‹ç³•    â”‚
â”‚ â–¡ è‚‰å ¡          â”‚
â”‚ â–¡ èŠå£«æ±‰å ¡      â”‚
â”‚                 â”‚
â”‚ æœ€å¤§è®¢å•æ•°ï¼š    â”‚
â”‚ [____4____]     â”‚
â”‚                 â”‚
â”‚ ç”Ÿæˆé—´éš”(ç§’)ï¼š  â”‚
â”‚ [____15____]    â”‚
â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åœ°å›¾ç¼–è¾‘åŒºåŸŸ

#### ç‰¹æ€§

1. **ç½‘æ ¼ç³»ç»Ÿ**
   - 17x13 æ ¼å­çš„ç½‘æ ¼ç”»å¸ƒï¼ˆå¯è‡ªå®šä¹‰å°ºå¯¸ï¼‰
   - æ¯æ ¼ 48x48 åƒç´ 
   - æ˜¾ç¤ºåæ ‡è¾…åŠ©çº¿

2. **äº¤äº’æ“ä½œ**
   - æ‹–æ‹½å·¥å…·é¢æ¿ä¸­çš„åœ°æ¿/å·¥ä½œç«™åˆ°åœ°å›¾ä¸Šæ”¾ç½®
   - ç‚¹å‡»é€‰ä¸­åœ°å›¾ä¸Šçš„å¯¹è±¡
   - æŒ‰ Delete/Backspace åˆ é™¤é€‰ä¸­å¯¹è±¡
   - é¼ æ ‡æ‚¬åœæ˜¾ç¤ºå¯¹è±¡ä¿¡æ¯æç¤º

3. **è§†è§‰åé¦ˆ**
   - ä½¿ç”¨æ¸¸æˆä¸­çš„çº¹ç†æ¸²æŸ“åœ°æ¿å’Œå·¥ä½œç«™
   - é€‰ä¸­å¯¹è±¡æ—¶æ˜¾ç¤ºé«˜äº®è¾¹æ¡†
   - æ— æ•ˆæ”¾ç½®ä½ç½®æ˜¾ç¤ºçº¢è‰²æç¤º

4. **è¾…åŠ©åŠŸèƒ½**
   - ç½‘æ ¼å¯¹é½
   - æ˜¾ç¤º/éšè—ç½‘æ ¼çº¿
   - ç¼©æ”¾ç”»å¸ƒï¼ˆ50% - 200%ï¼‰
   - æ’¤é”€/é‡åšæ“ä½œ
   - å¤åˆ¶/ç²˜è´´å¯¹è±¡

### å±æ€§é¢æ¿

æ ¹æ®é€‰ä¸­å¯¹è±¡ç±»å‹æ˜¾ç¤ºä¸åŒçš„å±æ€§ç¼–è¾‘å™¨ï¼š

#### åœ°æ¿å±æ€§

**æ™®é€šåœ°æ¿ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åœ°æ¿å±æ€§                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç±»å‹ï¼šæ™®é€šåœ°æ¿                   â”‚
â”‚ ä½ç½®ï¼šX [_5_]  Y [_5_]           â”‚
â”‚ çº¹ç†ï¼š[é»˜è®¤ â–¼]                   â”‚
â”‚ [åˆ é™¤]                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼ é€å¸¦åœ°æ¿ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¼ é€å¸¦å±æ€§                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç±»å‹ï¼šä¼ é€å¸¦                     â”‚
â”‚ ä½ç½®ï¼šX [_5_]  Y [_5_]           â”‚
â”‚ æ–¹å‘ï¼š[å³ â–¼]                     â”‚
â”‚ é€Ÿåº¦ï¼š[_100_] åƒç´ /ç§’            â”‚
â”‚ å…¥å£æ–¹å‘ï¼š[å·¦ â–¼] (å¯é€‰)          â”‚
â”‚ å‡ºå£æ–¹å‘ï¼š[å³ â–¼] (å¯é€‰)          â”‚
â”‚ [åˆ é™¤]                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å·¥ä½œç«™å±æ€§

**åˆ‡èœæ¿ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆ‡èœæ¿å±æ€§                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç±»å‹ï¼šåˆ‡èœæ¿                     â”‚
â”‚ ä½ç½®ï¼šX [_4_]  Y [_5_]           â”‚
â”‚ åˆ‡å‰²é€Ÿåº¦ï¼š[_1.0_] å€ç‡           â”‚
â”‚ æ—‹è½¬è§’åº¦ï¼š[_0_] åº¦               â”‚
â”‚ [åˆ é™¤]                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‚’é”…ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç‚’é”…å±æ€§                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç±»å‹ï¼šç‚’é”…                       â”‚
â”‚ ä½ç½®ï¼šX [_5_]  Y [_3_]           â”‚
â”‚ çƒ¹é¥ªé€Ÿåº¦ï¼š[_1.0_] å€ç‡           â”‚
â”‚ â˜‘ å¯ä»¥çƒ§ç„¦                       â”‚
â”‚ â˜‘ å¯ä»¥ç€ç«                       â”‚
â”‚ æ—‹è½¬è§’åº¦ï¼š[_0_] åº¦               â”‚
â”‚ [åˆ é™¤]                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é£Ÿæç®±ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é£Ÿæç®±å±æ€§                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç±»å‹ï¼šé£Ÿæç®±                    â”‚
â”‚ ä½ç½®ï¼šX [_4_]  Y [_4_]          â”‚
â”‚ é£Ÿæç±»å‹ï¼š[ç”Ÿèœ â–¼]              â”‚
â”‚ â˜‘ æ— é™ä¾›åº”                      â”‚
â”‚ æœ€å¤§æ•°é‡ï¼š[___] (ç¦ç”¨)          â”‚
â”‚ æ—‹è½¬è§’åº¦ï¼š[_0_] åº¦              â”‚
â”‚ [åˆ é™¤]                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç›˜å­æŸœå°ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç›˜å­æŸœå°å±æ€§                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç±»å‹ï¼šç›˜å­æŸœå°                  â”‚
â”‚ ä½ç½®ï¼šX [_6_]  Y [_6_]          â”‚
â”‚ â˜‘ æ— é™ä¾›åº”                      â”‚
â”‚ æœ€å¤§ç›˜å­æ•°ï¼š[___] (ç¦ç”¨)        â”‚
â”‚ æ—‹è½¬è§’åº¦ï¼š[_0_] åº¦              â”‚
â”‚ [åˆ é™¤]                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ç©å®¶å±æ€§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç©å®¶å±æ€§                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç¼–å·ï¼šç©å®¶ 1                    â”‚
â”‚ ä½ç½®ï¼šX [_4_]  Y [_6_]          â”‚
â”‚ é¢œè‰²ï¼š[#4da6ff] ğŸ¨              â”‚
â”‚ [åˆ é™¤]                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é¡¶éƒ¨æ“ä½œæ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å…³å¡ç¼–è¾‘å™¨    [æ–°å»º] [ä¿å­˜] [å¯¼å…¥] [å¯¼å‡º] [è¯•ç©] [è¿”å›ç¼–è¾‘]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### åŠŸèƒ½è¯´æ˜

1. **æ–°å»º** - æ¸…ç©ºå½“å‰ç¼–è¾‘ï¼Œåˆ›å»ºæ–°å…³å¡
2. **ä¿å­˜** - ä¿å­˜å½“å‰å…³å¡åˆ°æœ¬åœ°å­˜å‚¨
3. **å¯¼å…¥** - ä» JSON æ–‡ä»¶å¯¼å…¥å…³å¡
4. **å¯¼å‡º** - å¯¼å‡ºå…³å¡ä¸º JSON æ–‡ä»¶
5. **è¯•ç©** - è¿›å…¥æ¸¸æˆæ¨¡å¼æµ‹è¯•å½“å‰ç¼–è¾‘çš„å…³å¡
6. **è¿”å›ç¼–è¾‘** - ä»è¯•ç©æ¨¡å¼è¿”å›ç¼–è¾‘å™¨ï¼ˆä»…åœ¨è¯•ç©æ¨¡å¼æ˜¾ç¤ºï¼‰

### è¯•ç©æ¨¡å¼

#### åŠŸèƒ½æè¿°

è¯•ç©æ¨¡å¼å…è®¸å¼€å‘è€…åœ¨ç¼–è¾‘å™¨ä¸­å¿«é€Ÿæµ‹è¯•å…³å¡çš„æ¸¸æˆæ€§å’Œå¹³è¡¡æ€§ï¼Œæ— éœ€å®Œæ•´å¯¼å‡ºå’Œé‡æ–°åŠ è½½ã€‚

#### å·¥ä½œæµç¨‹

```
ç¼–è¾‘æ¨¡å¼ â”€â”€[ç‚¹å‡»è¯•ç©]â”€â”€> éªŒè¯å…³å¡ â”€â”€> åŠ è½½æ¸¸æˆåœºæ™¯ â”€â”€> è¯•ç©æ¨¡å¼
    â†‘                                                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ç‚¹å‡»è¿”å›ç¼–è¾‘]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å…·ä½“å®ç°

**1. è¿›å…¥è¯•ç©æ¨¡å¼**

```typescript
class LevelEditorScene extends Phaser.Scene {
  onPlaytestButtonClick() {
    // 1. éªŒè¯å…³å¡
    const levelConfig = this.exportCurrentLevel();
    const validation = validateLevel(levelConfig);
    
    if (!validation.valid) {
      // æ˜¾ç¤ºé”™è¯¯æç¤º
      this.showValidationErrors(validation.errors);
      return;
    }
    
    // 2. æ˜¾ç¤ºè­¦å‘Šï¼ˆå¦‚æœæœ‰ï¼‰
    if (validation.warnings.length > 0) {
      this.showValidationWarnings(validation.warnings);
    }
    
    // 3. ä¿å­˜ç¼–è¾‘å™¨çŠ¶æ€
    this.saveEditorState();
    
    // 4. æš‚åœç¼–è¾‘å™¨åœºæ™¯
    this.scene.pause();
    
    // 5. å¯åŠ¨æ¸¸æˆåœºæ™¯ï¼ˆä¼ å…¥è¯•ç©æ¨¡å¼æ ‡å¿—ï¼‰
    this.scene.launch('GameScene', {
      levelConfig: levelConfig,
      isPlaytest: true,
      editorSceneKey: this.scene.key
    });
  }
}
```

**2. æ¸¸æˆåœºæ™¯è¯†åˆ«è¯•ç©æ¨¡å¼**

```typescript
class GameScene extends Phaser.Scene {
  private isPlaytestMode: boolean = false;
  private editorSceneKey?: string;
  private playtestStats: PlaytestStats;
  
  create(data?: any) {
    // æ£€æŸ¥æ˜¯å¦ä¸ºè¯•ç©æ¨¡å¼
    if (data && data.isPlaytest) {
      this.isPlaytestMode = true;
      this.editorSceneKey = data.editorSceneKey;
      this.playtestStats = this.initPlaytestStats();
      
      // ä»é…ç½®åŠ è½½å…³å¡
      if (data.levelConfig) {
        loadLevelFromConfig(this, data.levelConfig);
      }
      
      // æ·»åŠ è¯•ç©æ¨¡å¼ UI
      this.createPlaytestUI();
    } else {
      // æ­£å¸¸æ¸¸æˆæ¨¡å¼
      this.createNormalGameUI();
    }
    
    // ... å…¶ä»–åˆå§‹åŒ–ä»£ç 
  }
  
  createPlaytestUI() {
    const { width } = this.scale;
    
    // æ·»åŠ "è¿”å›ç¼–è¾‘"æŒ‰é’®
    const backButton = this.add.text(20, 20, 'â† è¿”å›ç¼–è¾‘', {
      fontSize: '24px',
      backgroundColor: '#2196F3',
      padding: { left: 15, right: 15, top: 8, bottom: 8 }
    })
    .setDepth(DEPTH.UI)
    .setInteractive({ useHandCursor: true })
    .on('pointerup', () => this.exitPlaytest());
    
    // æ·»åŠ è¯•ç©æ¨¡å¼æç¤º
    this.add.text(width / 2, 20, 'è¯•ç©æ¨¡å¼ - æŒ‰ ESC è¿”å›ç¼–è¾‘å™¨', {
      fontSize: '18px',
      color: '#FFC107'
    })
    .setOrigin(0.5, 0)
    .setDepth(DEPTH.UI);
    
    // ç›‘å¬ ESC é”®
    this.input.keyboard?.on('keydown-ESC', () => {
      this.exitPlaytest();
    });
  }
  
  exitPlaytest() {
    // æ”¶é›†ç»Ÿè®¡æ•°æ®
    this.playtestStats.duration = this.time.now / 1000;
    this.playtestStats.score = this.score;
    
    // åœæ­¢å½“å‰åœºæ™¯
    this.scene.stop();
    
    // æ¢å¤ç¼–è¾‘å™¨åœºæ™¯å¹¶ä¼ é€’ç»Ÿè®¡æ•°æ®
    if (this.editorSceneKey) {
      this.scene.resume(this.editorSceneKey);
      this.scene.get(this.editorSceneKey).events.emit(
        'playtest-ended',
        this.playtestStats
      );
    }
  }
  
  initPlaytestStats(): PlaytestStats {
    return {
      duration: 0,
      score: 0,
      completedOrders: 0,
      failedOrders: 0,
      mostUsedStations: [],
      leastUsedStations: [],
      stationUsageCount: new Map()
    };
  }
  
  // åœ¨æ¸¸æˆå¾ªç¯ä¸­è®°å½•ç»Ÿè®¡æ•°æ®
  update(time: number, delta: number) {
    if (this.isPlaytestMode) {
      this.updatePlaytestStats();
    }
    // ... å…¶ä»–æ›´æ–°é€»è¾‘
  }
  
  updatePlaytestStats() {
    // è®°å½•å·¥ä½œç«™ä½¿ç”¨æƒ…å†µ
    ALL_PLAYERS.forEach(player => {
      // å‡è®¾ç©å®¶äº¤äº’æ—¶è§¦å‘äº‹ä»¶
      // è¿™é‡Œéœ€è¦åœ¨å®é™…çš„äº¤äº’é€»è¾‘ä¸­è®°å½•
    });
  }
}
```

**3. ç¼–è¾‘å™¨æ¥æ”¶è¯•ç©æ•°æ®**

```typescript
class LevelEditorScene extends Phaser.Scene {
  private playtestStats?: PlaytestStats;
  
  create() {
    // ... å…¶ä»–åˆå§‹åŒ–ä»£ç 
    
    // ç›‘å¬è¯•ç©ç»“æŸäº‹ä»¶
    this.events.on('playtest-ended', (stats: PlaytestStats) => {
      this.playtestStats = stats;
      this.showPlaytestResults(stats);
    });
  }
  
  showPlaytestResults(stats: PlaytestStats) {
    // åœ¨å±æ€§é¢æ¿æ˜¾ç¤ºç»Ÿè®¡æ•°æ®
    this.attributePanel.clear();
    this.attributePanel.showPlaytestStats(stats);
    
    // é«˜äº®æœªä½¿ç”¨çš„å·¥ä½œç«™
    this.highlightUnusedStations(stats.leastUsedStations);
  }
}
```

#### è¯•ç©æ¨¡å¼ UI å·®å¼‚

**æ­£å¸¸æ¸¸æˆæ¨¡å¼ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¾—åˆ†: 150    å‰©ä½™æ—¶é—´: 02:30:450     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¯•ç©æ¨¡å¼ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [â† è¿”å›ç¼–è¾‘]  å¾—åˆ†: 150  æ—¶é—´: 02:30  â”‚
â”‚   è¯•ç©æ¨¡å¼ - æŒ‰ ESC è¿”å›ç¼–è¾‘å™¨        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è¯•ç©æ•°æ®è®°å½•

è¯•ç©æ¨¡å¼ä¼šè®°å½•ç»Ÿè®¡æ•°æ®ï¼Œå¸®åŠ©å¼€å‘è€…ä¼˜åŒ–å…³å¡ï¼š

```typescript
interface PlaytestStats {
  duration: number;              // è¯•ç©æ—¶é•¿ï¼ˆç§’ï¼‰
  score: number;                 // è·å¾—çš„åˆ†æ•°
  completedOrders: number;       // å®Œæˆçš„è®¢å•æ•°
  failedOrders: number;          // å¤±è´¥çš„è®¢å•æ•°
  mostUsedStations: string[];    // æœ€å¸¸ç”¨çš„å·¥ä½œç«™
  leastUsedStations: string[];   // æœ€å°‘ç”¨çš„å·¥ä½œç«™
  stationUsageCount: Map<string, number>;  // å·¥ä½œç«™ä½¿ç”¨æ¬¡æ•°ç»Ÿè®¡
  playerDeaths?: number;         // ç©å®¶æ­»äº¡æ¬¡æ•°ï¼ˆå¦‚æœæœ‰ï¼‰
}
```

#### è¯•ç©ç»Ÿè®¡é¢æ¿

è¿”å›ç¼–è¾‘å™¨åï¼Œåœ¨å±æ€§é¢æ¿æ˜¾ç¤ºè¯•ç©ç»Ÿè®¡ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¯•ç©ç»Ÿè®¡                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¯•ç©æ—¶é•¿ï¼š2åˆ†30ç§’               â”‚
â”‚ è·å¾—åˆ†æ•°ï¼š150 / 300 (â­â­)      â”‚
â”‚ å®Œæˆè®¢å•ï¼š8 ä¸ª                  â”‚
â”‚ å¤±è´¥è®¢å•ï¼š2 ä¸ª                  â”‚
â”‚                                 â”‚
â”‚ æœ€å¸¸ç”¨å·¥ä½œç«™ï¼š                  â”‚
â”‚ - åˆ‡èœæ¿ (32æ¬¡)                 â”‚
â”‚ - ç‚’é”… (28æ¬¡)                   â”‚
â”‚ - ä¸Šèœå£ (8æ¬¡)                  â”‚
â”‚                                 â”‚
â”‚ æœªä½¿ç”¨å·¥ä½œç«™ï¼š                  â”‚
â”‚ - æ…æ‹Œå™¨ âš ï¸                      â”‚
â”‚ - ç­ç«å™¨                        â”‚
â”‚                                 â”‚
â”‚ å»ºè®®ï¼š                          â”‚
â”‚ â€¢ æ…æ‹Œå™¨æœªä½¿ç”¨ï¼Œè€ƒè™‘ç§»é™¤æˆ–è°ƒæ•´  â”‚
â”‚   è®¢å•æ± ä»¥åŒ…å«éœ€è¦æ…æ‹Œçš„èœå“    â”‚
â”‚ â€¢ å¾—åˆ†åä½ï¼Œå»ºè®®å¢åŠ æ—¶é•¿æˆ–é™ä½  â”‚
â”‚   ç›®æ ‡åˆ†æ•°                      â”‚
â”‚                                 â”‚
â”‚ [å†æ¬¡è¯•ç©] [æ¸…é™¤ç»Ÿè®¡]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ç¼–è¾‘å™¨å®ç°æŠ€æœ¯æ–¹æ¡ˆ

### æŠ€æœ¯æ ˆé€‰æ‹©

#### æ–¹æ¡ˆ 1ï¼šåŸºäº Phaser.jsï¼ˆæ¨èï¼‰

**ä¼˜ç‚¹ï¼š**

- ä¸æ¸¸æˆä¸»ä½“ä½¿ç”¨ç›¸åŒçš„å¼•æ“ï¼Œçº¹ç†å’Œæ¸²æŸ“é€»è¾‘å¯å¤ç”¨
- èƒ½å¤Ÿç²¾ç¡®é¢„è§ˆæ¸¸æˆæ•ˆæœ
- å¤„ç†æ‹–æ‹½ã€ç‚¹å‡»ç­‰äº¤äº’æ›´æ–¹ä¾¿

**ç¼ºç‚¹ï¼š**

- UI ç»„ä»¶éœ€è¦è‡ªå·±å®ç°æˆ–ä½¿ç”¨ UI åº“ï¼ˆå¦‚ rexUIï¼‰

**å®ç°æ€è·¯ï¼š**

```typescript
class LevelEditorScene extends Phaser.Scene {
  // ä½¿ç”¨ Phaser çš„ Grid ç³»ç»Ÿ
  // å¤ç”¨æ¸¸æˆä¸­çš„çº¹ç†ç”Ÿæˆé€»è¾‘
  // å®ç°æ‹–æ‹½ã€ç‚¹å‡»ç­‰äº¤äº’
}
```

#### æ–¹æ¡ˆ 2ï¼šåŸºäº HTML/CSS + Canvas

**ä¼˜ç‚¹ï¼š**

- UI ç»„ä»¶å¼€å‘æ›´å¿«ï¼ˆä½¿ç”¨ React/Vue ç­‰æ¡†æ¶ï¼‰
- è¡¨å•å¤„ç†æ›´æ–¹ä¾¿

**ç¼ºç‚¹ï¼š**

- éœ€è¦æ‰‹åŠ¨ç»˜åˆ¶æ¸¸æˆå¯¹è±¡
- ä¸æ¸¸æˆä¸»ä½“æ¸²æŸ“å¯èƒ½ä¸ä¸€è‡´

### æ•°æ®æµ

```
ç¼–è¾‘å™¨ç•Œé¢ â”€â”€â†’ LevelConfig å¯¹è±¡ â”€â”€â†’ JSON æ–‡ä»¶
    â†‘                                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             (å¯¼å…¥/å¯¼å‡º)
```

### æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

#### 1. åœ°å›¾ç®¡ç†å™¨

```typescript
class MapManager {
  private grid: (StationConfig | PlayerSpawn | null)[][];
  
  placeObject(obj: StationConfig | PlayerSpawn): boolean;
  removeObject(x: number, y: number): void;
  getObjectAt(x: number, y: number): any;
  validatePlacement(x: number, y: number): boolean;
  toLayout(): string[];
}
```

#### 2. é…ç½®ç®¡ç†å™¨

```typescript
class LevelConfigManager {
  private config: LevelConfig;
  
  updateBasicInfo(info: Partial<LevelConfig>): void;
  updateScoreTarget(target: ScoreTarget): void;
  addStation(station: StationConfig): void;
  removeStation(x: number, y: number): void;
  setOrderPool(pool: OrderPool): void;
  exportJSON(): string;
  importJSON(json: string): void;
  validate(): ValidationResult;
}
```

#### 3. æ¸²æŸ“ç®¡ç†å™¨

```typescript
class EditorRenderer {
  private scene: Phaser.Scene;
  
  renderGrid(): void;
  renderStation(config: StationConfig): void;
  renderPlayer(spawn: PlayerSpawn): void;
  highlightSelected(obj: any): void;
  showInvalidPlacement(x: number, y: number): void;
}
```

#### 4. äº¤äº’ç®¡ç†å™¨

```typescript
class EditorInteractionManager {
  private selectedTool: Tool;
  private selectedObject: any;
  
  onPointerDown(x: number, y: number): void;
  onPointerMove(x: number, y: number): void;
  onPointerUp(x: number, y: number): void;
  selectTool(tool: Tool): void;
  deleteSelected(): void;
}
```

## å…³å¡åŠ è½½æµç¨‹

### ä» JSON é…ç½®åŠ è½½å…³å¡

ç”±äºä¸å†ä½¿ç”¨å­—ç¬¦ä¸²çŸ©é˜µè¡¨ç¤ºåœ°å›¾ï¼ŒåŠ è½½æµç¨‹éœ€è¦ç›´æ¥ä»é…ç½®å¯¹è±¡åˆ›å»ºæ¸¸æˆå®ä½“ã€‚

```typescript
/**
 * ä» LevelConfig åŠ è½½å…³å¡
 */
function loadLevelFromConfig(scene: Phaser.Scene, config: LevelConfig): void {
  // 1. æ¸…ç©ºç°æœ‰æ¸¸æˆå¯¹è±¡
  ALL_PLAYERS.length = 0;
  ALL_ITEMS.length = 0;
  ALL_STATIONS.length = 0;
  
  // 2. è®¾ç½®æ¸¸æˆå‚æ•°
  scene.cutDownTime = config.duration;
  scene.scoreTarget = config.scoreTarget;
  
  // 3. åˆå§‹åŒ–ç‰©ç†ä¸–ç•Œè¾¹ç•Œ
  scene.physics.world.setBounds(
    0,
    0,
    TILE_SIZE * config.map.width,
    TILE_SIZE * config.map.height,
  );
  
  // 4. åˆ›å»ºåœ°æ¿
  createFloorsFromConfig(scene, config.map.floors);
  
  // 5. åˆ›å»ºå·¥ä½œç«™
  createStationsFromConfig(scene, config.stations);
  
  // 6. åˆ›å»ºç©å®¶
  createPlayersFromConfig(scene, config.players);
  
  // 7. é…ç½®è®¢å•æ± 
  orderManager.reset();
  orderManager.setRecipePool(
    config.orderPool.recipes.map(id => getRecipeById(id)).filter(Boolean)
  );
  
  // 8. è®¾ç½®ç¢°æ’æ£€æµ‹
  handleCollision(scene);
  handleThrow(scene);
}

/**
 * åˆ›å»ºåœ°æ¿
 */
function createFloorsFromConfig(
  scene: Phaser.Scene, 
  floors: FloorConfig[]
): void {
  floors.forEach(floorConfig => {
    const x = floorConfig.x * TILE_SIZE + TILE_SIZE / 2;
    const y = floorConfig.y * TILE_SIZE + TILE_SIZE / 2;
    
    switch (floorConfig.type) {
      case 'normal':
        createNormalFloor(scene, x, y, floorConfig);
        break;
      case 'wall':
        createWallFloor(scene, x, y, floorConfig);
        break;
      case 'conveyor':
        createConveyorFloor(scene, x, y, floorConfig as ConveyorFloor);
        break;
    }
  });
}

function createNormalFloor(
  scene: Phaser.Scene,
  x: number,
  y: number,
  config: NormalFloor
): void {
  const texture = config.texture || 'floor';
  scene.add.image(x, y, texture).setDepth(DEPTH.FLOOR);
}

function createWallFloor(
  scene: Phaser.Scene,
  x: number,
  y: number,
  config: WallFloor
): void {
  const texture = config.texture || 'wall';
  const wall = scene.physics.add.staticSprite(x, y, texture);
  wall.setDepth(DEPTH.FLOOR);
  // å¢™å£éœ€è¦ç¢°æ’ä½“
  wall.body.setSize(TILE_SIZE, TILE_SIZE);
}

function createConveyorFloor(
  scene: Phaser.Scene,
  x: number,
  y: number,
  config: ConveyorFloor
): void {
  const texture = config.texture || 'conveyor';
  const conveyor = scene.add.image(x, y, texture);
  conveyor.setDepth(DEPTH.FLOOR);
  
  // æ ¹æ®æ–¹å‘æ—‹è½¬çº¹ç†
  const rotationMap = {
    'up': -90,
    'down': 90,
    'left': 180,
    'right': 0
  };
  conveyor.setAngle(rotationMap[config.direction] || 0);
  
  // å­˜å‚¨ä¼ é€å¸¦é…ç½®åˆ°åœºæ™¯æ•°æ®ä¸­ï¼Œä¾›ç‰©ç†æ›´æ–°ä½¿ç”¨
  if (!scene.data.has('conveyors')) {
    scene.data.set('conveyors', []);
  }
  const conveyors = scene.data.get('conveyors') as ConveyorFloor[];
  conveyors.push(config);
}

/**
 * åˆ›å»ºå·¥ä½œç«™
 */
function createStationsFromConfig(
  scene: Phaser.Scene,
  stations: StationConfig[]
): void {
  stations.forEach(stationConfig => {
    const x = stationConfig.x * TILE_SIZE + TILE_SIZE / 2;
    const y = stationConfig.y * TILE_SIZE + TILE_SIZE / 2;
    
    let station: Station | null = null;
    
    switch (stationConfig.type) {
      case 'counter':
        station = new CounterStation(scene, x, y);
        break;
      case 'plate-counter':
        station = createPlateCounterStation(scene, x, y, stationConfig as PlateCounterStation);
        break;
      case 'cut':
        station = createCutStation(scene, x, y, stationConfig as CutStation);
        break;
      case 'pot':
        station = createPotStation(scene, x, y, stationConfig as PotStation);
        break;
      case 'sink':
        station = createSinkStation(scene, x, y, stationConfig as SinkStation);
        break;
      case 'delivery':
        station = new DeliveryStation(scene, x, y);
        break;
      case 'dirty-plate':
        station = createDirtyPlateStation(scene, x, y, stationConfig as DirtyPlateStation);
        break;
      case 'trash':
        station = new TrashStation(scene, x, y);
        break;
      case 'fire-extinguisher':
        station = createFireExtinguisherStation(scene, x, y, stationConfig as FireExtinguisherStation);
        break;
      case 'mixer':
        station = createMixerStation(scene, x, y, stationConfig as MixerStation);
        break;
      case 'ingredient':
        station = createIngredientStation(scene, x, y, stationConfig as IngredientStation);
        break;
    }
    
    if (station) {
      // åº”ç”¨æ—‹è½¬
      if (stationConfig.rotation) {
        station.sprite.setAngle(stationConfig.rotation);
      }
      ALL_STATIONS.push(station);
    }
  });
}

// è¾…åŠ©å‡½æ•°ï¼šåˆ›å»ºå¸¦å±æ€§çš„å·¥ä½œç«™
function createCutStation(
  scene: Phaser.Scene,
  x: number,
  y: number,
  config: CutStation
): CutStation {
  const station = new CutStation(scene, x, y);
  if (config.cutSpeed !== undefined) {
    station.workSpeed *= config.cutSpeed;
  }
  return station;
}

function createPotStation(
  scene: Phaser.Scene,
  x: number,
  y: number,
  config: PotStation
): PotStation {
  const station = new PotStation(scene, x, y);
  if (config.cookSpeed !== undefined) {
    station.workSpeed *= config.cookSpeed;
  }
  if (config.canBurn !== undefined) {
    station.canBurn = config.canBurn;
  }
  if (config.canFire !== undefined) {
    station.canFire = config.canFire;
  }
  return station;
}

function createIngredientStation(
  scene: Phaser.Scene,
  x: number,
  y: number,
  config: IngredientStation
): IngredientStation {
  // æ ¹æ®é£Ÿæç±»å‹è·å–å¯¹åº”çš„é£Ÿæç±»
  const ingredientClassMap: Record<string, any> = {
    'tomato': Tomato,
    'lettuce': Lettuce,
    'rice': Rice,
    'fish': Fish,
    'seaweed': Seaweed,
    'onion': Onion,
    'potato': Potato,
    'carrot': Carrot,
    'egg': Egg,
    'flour': Flour,
  };
  
  const ingredientClass = ingredientClassMap[config.ingredientType];
  if (!ingredientClass) {
    throw new Error(`Unknown ingredient type: ${config.ingredientType}`);
  }
  
  const station = new IngredientStation(scene, x, y, ingredientClass);
  
  // åº”ç”¨å±æ€§
  if (config.infinite !== undefined) {
    station.infinite = config.infinite;
  }
  if (config.maxCount !== undefined) {
    station.maxCount = config.maxCount;
  }
  
  return station;
}

/**
 * åˆ›å»ºç©å®¶
 */
function createPlayersFromConfig(
  scene: Phaser.Scene,
  players: PlayerSpawn[]
): void {
  const defaultKeyMaps = [
    {
      up: "W",
      down: "S",
      left: "A",
      right: "D",
      pick: "E",
      work: "R",
      throw: "SPACE",
      dash: "SHIFT",
    },
    {
      up: "UP",
      down: "DOWN",
      left: "LEFT",
      right: "RIGHT",
      pick: "O",
      work: "P",
      throw: "L",
      dash: "ENTER",
    }
  ];
  
  players.forEach((playerConfig, index) => {
    const x = playerConfig.x * TILE_SIZE + TILE_SIZE / 2;
    const y = playerConfig.y * TILE_SIZE + TILE_SIZE / 2;
    const color = playerConfig.color || (index === 0 ? 0x4da6ff : 0xff4444);
    const keyMap = defaultKeyMaps[index] || defaultKeyMaps[0];
    
    const player = new Player(scene, playerConfig.id, x, y, color, keyMap);
    createPlayer(player);
  });
}
```

### ä¼ é€å¸¦ç‰©ç†æ›´æ–°

ä¼ é€å¸¦éœ€è¦åœ¨æ¸¸æˆå¾ªç¯ä¸­æŒç»­æ›´æ–°ç©å®¶å’Œç‰©å“çš„ä½ç½®ã€‚

```typescript
/**
 * åœ¨ GameScene.update() ä¸­è°ƒç”¨
 */
function updateConveyors(scene: Phaser.Scene, delta: number): void {
  const conveyors = scene.data.get('conveyors') as ConveyorFloor[] | undefined;
  if (!conveyors) return;
  
  conveyors.forEach(conveyor => {
    const conveyorX = conveyor.x * TILE_SIZE + TILE_SIZE / 2;
    const conveyorY = conveyor.y * TILE_SIZE + TILE_SIZE / 2;
    const halfTile = TILE_SIZE / 2;
    
    // æ£€æŸ¥ç©å®¶æ˜¯å¦åœ¨ä¼ é€å¸¦ä¸Š
    ALL_PLAYERS.forEach(player => {
      const dx = Math.abs(player.x - conveyorX);
      const dy = Math.abs(player.y - conveyorY);
      
      if (dx < halfTile && dy < halfTile) {
        // ç©å®¶åœ¨ä¼ é€å¸¦ä¸Šï¼Œåº”ç”¨æ¨åŠ›
        applyConveyorForce(player, conveyor, delta);
      }
    });
    
    // æ£€æŸ¥ç‰©å“æ˜¯å¦åœ¨ä¼ é€å¸¦ä¸Š
    ALL_ITEMS.forEach(item => {
      if (item.isFlying || item.heldBy) return; // é£è¡Œæˆ–è¢«æŒæœ‰çš„ç‰©å“ä¸å—ä¼ é€å¸¦å½±å“
      
      const dx = Math.abs(item.x - conveyorX);
      const dy = Math.abs(item.y - conveyorY);
      
      if (dx < halfTile && dy < halfTile) {
        applyConveyorForce(item, conveyor, delta);
      }
    });
  });
}

function applyConveyorForce(
  object: Phaser.Physics.Arcade.Sprite,
  conveyor: ConveyorFloor,
  delta: number
): void {
  const force = (conveyor.speed * delta) / 1000; // è½¬æ¢ä¸ºæ¯å¸§çš„ç§»åŠ¨é‡
  
  switch (conveyor.direction) {
    case 'up':
      object.y -= force;
      break;
    case 'down':
      object.y += force;
      break;
    case 'left':
      object.x -= force;
      break;
    case 'right':
      object.x += force;
      break;
  }
}
```

### ä»å½“å‰æ¸¸æˆçŠ¶æ€å¯¼å‡º JSON

ç¼–è¾‘å™¨éœ€è¦èƒ½å¤Ÿå°†å½“å‰çš„æ¸¸æˆçŠ¶æ€å¯¼å‡ºä¸º JSON é…ç½®ã€‚

```typescript
/**
 * å°†å½“å‰æ¸¸æˆçŠ¶æ€å¯¼å‡ºä¸º LevelConfig
 */
function exportLevelConfig(scene: Phaser.Scene): LevelConfig {
  // æ”¶é›†åœ°æ¿
  const floors: FloorConfig[] = [];
  const floorSprites = scene.children.list.filter(
    obj => obj.depth === DEPTH.FLOOR
  );
  
  floorSprites.forEach((sprite: any) => {
    const floorData = sprite.getData('floorConfig');
    if (floorData) {
      floors.push(floorData);
    }
  });
  
  // æ”¶é›†å·¥ä½œç«™
  const stations: StationConfig[] = ALL_STATIONS.map(station => {
    const baseConfig: BaseStationConfig = {
      type: station.type,
      x: Math.round((station.x - TILE_SIZE / 2) / TILE_SIZE),
      y: Math.round((station.y - TILE_SIZE / 2) / TILE_SIZE),
    };
    
    if (station.sprite.angle !== 0) {
      baseConfig.rotation = station.sprite.angle;
    }
    
    // æ ¹æ®å·¥ä½œç«™ç±»å‹æ·»åŠ ç‰¹å®šå±æ€§
    switch (station.type) {
      case 'ingredient':
        return {
          ...baseConfig,
          ingredientType: (station as IngredientStation).ingredientType,
          infinite: (station as IngredientStation).infinite,
          maxCount: (station as IngredientStation).maxCount,
        } as IngredientStation;
      
      case 'pot':
        return {
          ...baseConfig,
          cookSpeed: (station as PotStation).workSpeed,
          canBurn: (station as PotStation).canBurn,
          canFire: (station as PotStation).canFire,
        } as PotStation;
      
      // å…¶ä»–ç±»å‹ç±»ä¼¼å¤„ç†...
      default:
        return baseConfig as StationConfig;
    }
  });
  
  // æ”¶é›†ç©å®¶
  const players: PlayerSpawn[] = ALL_PLAYERS.map(player => ({
    id: player.id,
    x: Math.round((player.x - TILE_SIZE / 2) / TILE_SIZE),
    y: Math.round((player.y - TILE_SIZE / 2) / TILE_SIZE),
    color: player.tintTopLeft,
  }));
  
  // æ„å»ºå®Œæ•´é…ç½®
  const config: LevelConfig = {
    id: generateLevelId(),
    name: 'æœªå‘½åå…³å¡',
    version: '1.0',
    gameType: 'local-coop',
    duration: scene.cutDownTime || 300,
    scoreTarget: scene.scoreTarget || {
      star1: 100,
      star2: 200,
      star3: 300,
    },
    map: {
      width: Math.ceil(scene.physics.world.bounds.width / TILE_SIZE),
      height: Math.ceil(scene.physics.world.bounds.height / TILE_SIZE),
      floors,
    },
    players,
    stations,
    orderPool: {
      recipes: orderManager.getAllRecipeIds(),
      maxActiveOrders: 4,
      spawnInterval: 15,
    },
  };
  
  return config;
}

function generateLevelId(): string {
  return `level-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
}
```

## éªŒè¯è§„åˆ™

### å…³å¡æœ‰æ•ˆæ€§æ£€æŸ¥

```typescript
interface ValidationResult {
  valid: boolean;
  errors: string[];
  warnings: string[];
}

function validateLevel(config: LevelConfig): ValidationResult {
  const errors: string[] = [];
  const warnings: string[] = [];
  
  // å¿…é¡»æœ‰è‡³å°‘ä¸€ä¸ªç©å®¶
  if (config.players.length === 0) {
    errors.push('å…³å¡å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªç©å®¶å‡ºç”Ÿç‚¹');
  }
  
  // å¿…é¡»æœ‰ä¸Šèœå£
  const hasDelivery = config.stations.some(s => s.type === 'delivery');
  if (!hasDelivery) {
    errors.push('å…³å¡å¿…é¡»æœ‰è‡³å°‘ä¸€ä¸ªä¸Šèœå£');
  }
  
  // å¿…é¡»æœ‰ç›˜å­æ¥æº
  const hasPlate = config.stations.some(s => s.type === 'plate-counter');
  if (!hasPlate) {
    warnings.push('å…³å¡æ²¡æœ‰ç›˜å­æŸœå°ï¼Œç©å®¶æ— æ³•è·å–ç›˜å­');
  }
  
  // æ£€æŸ¥è®¢å•æ± ä¸­çš„èœè°±æ˜¯å¦éœ€è¦å…³å¡ä¸­æ²¡æœ‰çš„é£Ÿæ
  const availableIngredients = new Set(
    config.stations
      .filter(s => s.type === 'ingredient')
      .map(s => s.ingredientType)
  );
  
  config.orderPool.recipes.forEach(recipeId => {
    const recipe = getRecipeById(recipeId);
    if (recipe) {
      const required = getRequiredIngredients(recipe);
      const missing = required.filter(ing => !availableIngredients.has(ing));
      if (missing.length > 0) {
        warnings.push(
          `èœè°±"${recipe.displayName}"éœ€è¦çš„é£Ÿæ"${missing.join('ã€')}"åœ¨å…³å¡ä¸­ä¸å¯ç”¨`
        );
      }
    }
  });
  
  return {
    valid: errors.length === 0,
    errors,
    warnings
  };
}
```

# ä»»åŠ¡åˆ†è§£
